<%- active_folder_index = active_folder_id = 0 -%>
<div id="bookmark">
  <%- Folder.recents.each_with_index do |folder, idx| -%>
      <%-
          if folder.id == session[:current_folder].to_i
            active_folder_index = idx
            active_folder_id = folder.id
          end
      -%>
      <div class="bmfolder" data-folder-id="<%= folder.id %>"><%= folder.title %></div>
      <div>
        <ul class="bmlist">
          <%- folder.bookmarks.each do |bookmark| -%>
              <li id="bm-<%= bookmark.id %>"><span class="ui-icon ui-icon-document"></span><%= link_to_bookmark(bookmark) %></li>
          <%- end -%>
        </ul>
      </div>
  <%- end -%>
</div>

<div class="accordion" id="accordion" role="tablist" aria-multiselectable="true">
  <%- Folder.recents.each_with_index do |folder, idx| -%>
      <%-
          if folder.id == session[:current_folder].to_i
            active_folder_index = idx
            active_folder_id = folder.id
          end
      -%>
  <div class="card">
    <div class="card-header" role="tab" id="headingOne">
      <h5 class="mb-0">
        <a class="text-body" data-toggle="collapse" href="#collapseOne" role="button" aria-expanded="true" aria-controls="collapseOne">
          <%= folder.title %>
        </a>
      </h5>
    </div><!-- /.card-header -->
    <div id="collapseOne" class="collapse show" role="tabpanel" aria-labelledby="headingOne" data-parent="#accordion">
      <%- folder.bookmarks.each do |bookmark| -%>
        <div class="card-body">
          アイテム1のコンテンツ
        </div><!-- /.card-body -->
      <%- end -%>
    </div><!-- /.collapse -->
  </div><!-- /.card -->
  <%- end -%>
  <div class="card">
    <div class="card-header" role="tab" id="headingTwo">
      <h5 class="mb-0">
        <a class="collapsed text-body" data-toggle="collapse" href="#collapseTwo" role="button" aria-expanded="false" aria-controls="collapseTwo">
          アイテム2
        </a>
      </h5>
    </div><!-- /.card-header -->
    <div id="collapseTwo" class="collapse" role="tabpanel" aria-labelledby="headingTwo" data-parent="#accordion">
      <div class="card-body">
        アイテム2のコンテンツ
      </div><!-- /.card-body -->
    </div><!-- /.collapse -->
  </div><!-- /.card -->
  <div class="card">
    <div class="card-header" role="tab" id="headingThree">
      <h5 class="mb-0">
        <a class="collapsed text-body" data-toggle="collapse" href="#collapseThree" role="button" aria-expanded="false" aria-controls="collapseThree">
          アイテム3
        </a>
      </h5>
    </div><!-- /.card-header -->
    <div id="collapseThree" class="collapse" role="tabpanel" aria-labelledby="headingThree" data-parent="#accordion">
      <div class="card-body">
        アイテム3のコンテンツ
      </div><!-- /.card-body -->
    </div><!-- /.collapse -->
  </div><!-- /.card -->
</div><!-- /#accordion -->

<p>
  <span class="ui-icon ui-icon-circle-plus"></span>
  <a href="" id="new_fonder_button">新規フォルダ作成</a>
</p>

<%= form_for Folder.new(), :url => add_folders_path, remote: true, :html => {:style => 'display: none;'} do |f| %>
    日付　 <%= f.text_field :title_date, size: 12 %><br />
    集会名 <%= f.text_field :title, size: 22 %><br />
    <%= f.submit %>
<%- end -%>
<p>
  <span class="ui-icon ui-icon-newwin"></span>
  <a href="<%= folders_path %>" id="edit_folder_link" target="_blank">フォルダの編集</a>
</p>

<script type="text/javascript">
    $(function () {
        var folders_path = '<%= folders_path %>'
        var active_folder_id = <%= active_folder_id %>;
        $('#bookmark').accordion({active: <%= active_folder_index %>, collapsible: true});
        $('.bmlist').sortable({
            stop: function(event, ui) {
                $.post(folders_path + '/' + active_folder_id + '/reorder', $(this).sortable('serialize'), null, 'text' )
            }
        });
        $('.bmfolder').click(function(){
            active_folder_id = this.dataset.folderId;
            $.post('<%= set_current_folders_path() %>', {f: this.dataset.folderId} , null, 'json')
        });

        var options = {
            dateFormat: 'yy-mm-dd',
            buttonImageOnly: true,
            buttonImage: '/assets/datepicker.gif'
        };
        $('#folder_title_date').datepicker(options);

        $('#new_folder').on('ajax:success', function(date, res){
            $('#bookmark_container').html(res);
        });
        
        $('#new_folder').on('click', function(event) { $("#new_folder").toggle(); });

        $('#edit_folder_link').click(
                function () {
                    $(this).attr('href', folders_path + '/' + active_folder_id + '/edit');
                }
        )
    });
</script>

